const _time = parseInt(new Date().getTime() / 1000);
const _datetime = new Date(new Date().getTime() + (480 - 180 - Math.floor(Math.random() * 480)) * 60 * 1000).toISOString().replace("T", " ").slice(0, 19);
const _idcard = localStorage.getItem("_idcard") || "110******019";
const _name = localStorage.getItem("_name") || "习近平";
const _phone = localStorage.getItem("_phone") || "130****8964";
const _qrcode_color = "green," + _time;
const _sample_spot = localStorage.getItem("_sample_spot") || "南京鼓楼医院采样点";
const t = CryptoJS.enc.Utf8.parse("kMB6D6T4uHE572QX");
const _qrcode_color_info = CryptoJS.AES.encrypt(_qrcode_color, t, {
  mode: CryptoJS.mode.ECB,
  padding: CryptoJS.pad.Pkcs7
}).toString();
const result_map = {
  "/jkm/2/userAuth_token": {"userdetail":{"abc":"","cardid":_idcard,"sex":"","mAbc":"","mobile":_phone,"name":_name,"update_frequency_day":14,"uuid":"","paperstype":"1","qwe":""},"version":"V2022031401"},
  "/jkm/2/queryUserInfo": {"cityNo":"320000","abc":"","idType":"1","level":_qrcode_color_info,"mAbc":"","commitCount":0,"idcardNo":_idcard,"cityData":false,"scanFlag":"1266adc7ecb660f9be2120af737427a24de6c47f4ba3fed422b44765b2db5d3b10caea6","zjgxsj":_datetime,"version":"V20220207","extInfo":{},"remainDays":13,"currentTime":_time,"originReason":"","qrCode":"0","phone":_phone,"idcardType":"IDENTITY_CARD","name":_name,"qrCodeText":"https://h5.dingtalk.com/healthAct/index.html","id":0,"qwe":"","info":{"id":0,"phone":_phone,"leveldata":"1","username":_name,"genderdata":"5","idtype":"身份证","userid":_idcard,"addr":null,"national":null,"r1data":"0","r2data":"0","r3data":"0","r4data":"0","r5data":"0","r6data":"0","r7data":"0","modified":0,"createtime":_time,"updatetime":0,"deletetime":0,"current_location":"南京市,秦淮区,双塘街道","current_address":"********","arrival_location":"江苏省,南京市,秦淮区","arrival_address":null,"arrival_date":0,"source":null,"realtimeLocation":null,"current_location_code":"320104004","arrival_location_code":"320104","parent_id":null,"relation":"null","uuid":null,"ymShow":null,"ymStatus":null},"exceed14Day":false},
  "/jkm/2/queryVaccine": {"msg":"返回成功","currentTime":_time,"data":[{"inocDate":"2021-05-02","inocUnit":"中华门社区卫生服务中心","bactName":"新冠Vero（科兴中维）1"},{"inocDate":"2021-05-28","inocUnit":"中华门社区卫生服务中心","bactName":"新冠Vero（科兴中维）2"},{"inocDate":"2021-08-03","inocUnit":"中华门社区卫生服务中心","bactName":"新冠Vero（科兴中维）3"}],"success":true},
  "/healthCode/queryHs": {"currentTime":_time,"hs":{"area":"","collectTime":_datetime,"collectUnit": _sample_spot,"collectCity":"南京市","checkResult":"阴性","checkUnit":""}},
  "/healthCode/queryLatestHs": {"currentTime":_time,"hs":{"area":"","collectTime":_datetime,"collectUnit": _sample_spot,"collectCity":"南京市","checkResult":"阴性","checkUnit":""}},
  "/healthCode/queryVaccQc": {"currentTime":_time,"ymStatus":"2"},
  "/healthCode/queryYmStatus": {"currentTime":_time,"ymStatus":"2"},
  "/jkm/2/queryTip": {"track_matching":true,"tip":"绿色：勤洗手、常通风、戴口罩，出现发热咳嗽等症状请及时就医","popUser":null,"rxjjgl":0}
}

$.ajax = (options) => {
  if ("url" in options && "success" in options
      && options["url"] in result_map) {
    const url = options["url"];
    options["success"]({
      "resMessage": "OK",
      "resCode": 0,
      "res": result_map[url]
    });
  }
}

$("#code-name").on("click", () => {
  const res = window.prompt("修改名字：", _name);
  if (res == "" || res == null) localStorage.removeItem("_name");
  else localStorage.setItem("_name", res);
  window.location.reload();
});

$("#code-tel").on("click", () => {
  const res = window.prompt("修改手机号：", _phone);
  if (res == "" || res == null) localStorage.removeItem("_phone");
  else localStorage.setItem("_phone", `${res.slice(0, 3)}****${res.slice(-4)}`);
  window.location.reload();
});

$("#code-id").on("click", () => {
  const res = window.prompt("修改证件号：", _idcard);
  if (res == "" || res == null) localStorage.removeItem("_idcard");
  else localStorage.setItem("_idcard", `${res.slice(0, 3)}******${res.slice(-3)}`);
  window.location.reload();
});

$(document).on("click", "#hs-list > div > span:eq(1)", null, () => {
  const res = window.prompt("修改采样点：", _sample_spot);
  if (res == "" || res == null) localStorage.removeItem("_sample_spot");
  else localStorage.setItem("_sample_spot", res);
  window.location.reload();
});

let _place_name = localStorage.getItem("_place_name") || "T1航站楼出发交通中心";
let _place_addr = localStorage.getItem("_place_addr") || "江苏省南京市禄口街道南京禄口国际机场南京禄口国际机场T1航站楼";

function loadPlace() {
  _place_name = localStorage.getItem("_place_name") || "T1航站楼出发交通中心";
  _place_addr = localStorage.getItem("_place_addr") || "江苏省南京市禄口街道南京禄口国际机场南京禄口国际机场T1航站楼";
  $("#cover > #name").text("场所名称：" + _place_name);
  $("#cover > #address").text("场所地址：" + _place_addr);
}

$("body").on("click", "#cover > #name", null, () => {
  const res = window.prompt("修改场所名称：", _place_name);
  res?localStorage.setItem("_place_name", res):localStorage.removeItem("_place_name");
  loadPlace();
});

$("body").on("click", "#cover > #address", null, () => {
  const res = window.prompt("修改场所地址：", _place_addr);
  res?localStorage.setItem("_place_addr", res):localStorage.removeItem("_place_addr");
  loadPlace();
});

$("body").on("click", "#czsm", null, () => {
  window.alert("点击健康码可以模拟场所码签到；点击名字/手机号/证件号/场所名称/场所地址可以修改相应信息。修改会缓存在本地，清除输入框并点击确认以恢复默认值。");
});

let show = false;

if (window.location.hash == "#checkin") {
  $(document).ready(() => {
    show = true;
    $("#cover").show();
    loadPlace();
  });
}

$("body").on("click", "#ymjz", null, () => {
  show = !show;
  if (show) {
    $("#cover").show(); loadPlace();
  } else {
    $("#cover").hide();
  }
});

/*! 
 jkm 
 hsw 
 2022-10-11 
*/

"use strict";var apiUrl="",realtimeLocation="",errorMsg="",source=formUrl(),userinfoDetail=new Object;function getUrlParam(e){for(var t=window.location.search.substring(1).split("&"),a=0;a<t.length;a++){var r=t[a].split("=");if(r[0]==e)return r[1]}return!1}function formUrl(){var e=window.navigator.userAgent.toLowerCase();return"alipayclient"==e.match(/AlipayClient/i)?"alipay":"hanweb"==e.match(/hanweb/i)?"jszwfw":"micromessenger"==e.match(/MicroMessenger/i)?"weixin":"unionpay"==e.match(/unionpay/i)||"updebug"==e.match(/updebug/i)?"unionpay":window.auth?"mynj":"other"}function time(){var e=new Date,t=e.getFullYear(),a=e.getMonth()+1,r=e.getDate(),s=e.getHours(),o=e.getMinutes(),n=e.getSeconds();return t+"-"+add_zero(a)+"-"+add_zero(r)+" "+add_zero(s)+":"+add_zero(o)+":"+add_zero(n)}function getTime(e){var t=new Date(e*=1e3),a=t.getFullYear(),r=t.getMonth()+1,s=t.getDate(),o=t.getHours(),n=t.getMinutes(),l=t.getSeconds();return a+"-"+add_zero(r)+"-"+add_zero(s)+" "+add_zero(o)+":"+add_zero(n)+":"+add_zero(l)}function getDayTime(e){var t=new Date(e*=1e3),a=t.getFullYear(),r=t.getMonth()+1,s=t.getDate();return t.getHours(),t.getMinutes(),t.getSeconds(),a+"-"+add_zero(r)+"-"+add_zero(s)}function add_zero(e){return 10<=e?e:"0"+e}function getDataObj(){var e=new Date;e.getFullYear(),e.getMonth(),e.getDate();for(var t=[],a=0;a<e.getFullYear()-2019;a++){var r={},s=2019+a+1;r.value=2019+a+1;for(var o=[],n=0;n<12;n++){var l={};l.value=n<9?"0"+(n+1):n+1;var i=[];if(1==n)if(s%4==0&&s%100!=0||s%400==0)for(var d=0;d<29;d++){var c={};c.value=d<9?"0"+(d+1):d+1,i.push(c)}else for(var u=0;u<28;u++){var h={};h.value=u<9?"0"+(u+1):u+1,i.push(h)}else if(0==n||2==n||4==n||6==n||7==n||9==n||11==n)for(var f=0;f<31;f++){var m={};m.value=f<9?"0"+(f+1):f+1,i.push(m)}else for(var p=0;p<30;p++){var $={};$.value=p<9?"0"+(p+1):p+1,i.push($)}l.childs=i,o.push(l)}r.childs=o,t.push(r)}return t}function jkmGetLocation(){ready(function(){AlipayJSBridge.call("getCurrentLocation",{requestType:1,bizType:"jkm_js_location"},function(e){e.error||(realtimeLocation=e.city+","+e.district)})})}function ready(e){window.AlipayJSBridge?e&&e():document.addEventListener("AlipayJSBridgeReady",e,!1)}function setLocalUserinfo(e){layer.closeAll("loading");var t=hideUserName(e.name);$("#name").val(t),$("#cardid").val(e.cardid),$("#telnum").val(e.mobile),queryUserInfo(userinfoDetail)}function hideUserName(e){if(e){if(10<e.length){var t=e.length-8;e=e.substr(0,4)+"**"+e.substr(t+4)}else e="*"+e.substr(1);return e}return""}function hideUserID(e){if(e){if(18==e.length)e=e.substr(0,6)+"********"+e.substr(14);else{for(var t=e.length-4,a="",r=0;r<t;r++)a+="*";e=e.substr(0,2)+a+e.substr(t+2)}return e}return""}function hideUserTel(e){return e?e=e.substr(0,3)+"****"+e.substr(7):""}function errMsgSave(){}function webClose(){"alipay"==source?ap.popWindow():history.go(-1)}function checkPhone(e){return!!/^1[3456789]\d[\*|\d]{4}\d{4}$/.test(e)}function checkPhone2(e){return!!/^1[3456789]\d{9}$/.test(e)}function isIdCardNo(e){if(e=e.toUpperCase(),!/(^\d{17}([0-9]|X)$)/.test(e))return!1;var t;if(null=={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江 ",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",83:"台湾",91:"国外"}[parseInt(e.substr(0,2))])return!1;if(18!=e.length)return!1;t=new RegExp(/^(\d{6})(\d{4})(\d{2})(\d{2})(\d{3})([0-9]|X)$/);var a=e.match(t),r=new Date(a[2]+"/"+a[3]+"/"+a[4]);if(r.getFullYear()!=Number(a[2])||r.getMonth()+1!=Number(a[3])||r.getDate()!=Number(a[4]))return!1;var s,o=new Array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2),n=new Array("1","0","X","9","8","7","6","5","4","3","2"),l=0;for(s=0;s<17;s++)l+=e.substr(s,1)*o[s];return n[l%11]==e.substr(17,1)}function setNewVal(e){return""==e?"":e.replace(/[`~!@#$^&()=|{}':;'\\\[\]\<>\/?~！@#￥……&（）——|{}【】'；：""'、？\s]/g,"")}function format(e){var t=new Date(1e3*e),a=(t.getFullYear(),t.getMonth()+1),r=t.getDate(),s=t.getHours(),o=t.getMinutes(),n=t.getSeconds();return add0(a)+"-"+add0(r)+" "+add0(s)+":"+add0(o)+":"+add0(n)}function add0(e){return e<10?"0"+e:e}function hideCardID(e){if(e){if(18==e.length)e=e.substr(0,3)+"******"+e.substr(15);else{for(var t=e.length-3,a="",r=0;r<t-2;r++)a+="*";e=e.substr(0,2)+a+e.substr(t)}return e}return""}function showModalText(e,t){var a="否";"1"==t&&(a="是"),$("#"+e).text(a)}function showText(e){var t="否";return"1"==e&&(t="是"),t}$(function(){$(".ui-radio").click(function(){$(this).parent(".ui-controlgroup").find("div.ui-radio>.jqradiowrapper>a.jqradio").removeClass("jqchecked"),$(this).find(".jqradiowrapper>a.jqradio").addClass("jqchecked")}),$("body").on("click",".choose",function(){$(this).removeClass("choose")}),jkmGetLocation()});var jmopenurl="http://www.jszwfw.gov.cn/jmopen/interfaces/",uuid1=getUrlParam("uuid"),uuid2=getUrlParam("jszwuserid"),uuid=uuid2||uuid1;function verifyToken(e){$.ajax({url:"/jkm/2/userAuth_token",type:"post",dataType:"json",data:{token:e,uuid:uuid,source:formUrl()},beforeSend:function(e,t){this.url=apiUrl+this.url,layer.load(1)},success:function(e){0==e.resCode?(userinfoDetail=e.res.userdetail,$(".update-fday-span").html(userinfoDetail.update_frequency_day),userinfoDetail.name&&userinfoDetail.cardid&&userinfoDetail.mobile?(setLocalUserinfo(userinfoDetail),userinfoDetail.cardid.length<10&&(errorMsg="paperstype info."+userdetail+"errEnd.")):(errorMsg="miss main info."+JSON.stringify(e)+"errEnd.",userinfoDetail.cardid?userinfoDetail.name?userinfoDetail.mobile||(setLocalUserinfo(userinfoDetail),userinfoDetail.cardid.length<10&&(errorMsg="paperstype info."+userdetail+"errEnd.")):(alert("E003:请先进行实名认证!"),webClose()):(alert("E002:请先进行实名认证"),webClose()))):alert(e.resMessage)},error:function(){alert("E004")},complete:function(){layer.closeAll("loading"),$(".title-pic").removeClass("hide")}})}function verifyTicket(e){return verifyTokenTicket("",e),!1}function verifyTicket2(e){$.ajax({url:"/jkm/2/userAuth_ticket",type:"post",dataType:"json",data:{ticket:e},beforeSend:function(e,t){this.url=apiUrl+this.url,layer.load(1)},success:function(e){0==e.resCode?verifyToken(e.res):alert(e.resMessage)},complete:function(){layer.closeAll("loading")}})}function login(){lightAppJssdk.user.getTicket({success:function(e){"未登录"==e?lightAppJssdk.user.loginapp({success:function(e){1!=(e=JSON.parse(e)).result&&"true"!=e.result||lightAppJssdk.user.getTicket({success:function(e){(e=JSON.parse(e)).ticket,verifyTicket(e.ticket)},fail:function(e){lightAppJssdk.notification.alert({message:"获取用户信息失败，请稍后重试",title:"提示",buttonName:"确认"}),alert("E008"),errorMsg="login failed.errEnd."}})},fail:function(e){errorMsg="login api failed.errEnd.",alert("E009:登陆失败"),webClose()}}):verifyTicket2(JSON.parse(e).ticket)},fail:function(e){errorMsg="get userinfo failed.errEnd.",lightAppJssdk.notification.alert({message:"获取用户信息失败",title:"提示",buttonName:"确认"}),alert("E010:获取用户信息失败"),webClose()}})}uuid=uuid||"";var childInfoObj=new Object;childInfoObj.editFlag=1;var currentTime,collectTime,hsjcTime,timer,startX,startY,moveEndX,moveEndY,X,Y,addInfoObj=new Object,userInfoObj=new Object,fillInfoObj=new Object,fillObj=new Object,familyInfoObj=new Object,warning=!0,confirm14day_flag=0,checkDataFlag=0,useUserInfo={name:"",sex:0,cardid:"",idType:"",paperstype:"",fromFlag:1},queryLatestHsFlag=0,queryVaccQcFlag=0,VERSIONSTATIC="V2022031401";function queryUserInfo(e){timer&&clearTimeout(timer),useUserInfo.name=e.name,useUserInfo.sex=e.sex,useUserInfo.abc=e.abc,useUserInfo.qwe=e.qwe,useUserInfo.cardid=e.cardid;var t=1,a="";useUserInfo.qwe==userinfoDetail.qwe?(a=getUrlParam("uid"),t=1,$(".gwyxckcx").removeClass("hide")):(a="",t=2,$(".gwyxckcx").addClass("hide")),$.ajax({url:"/jkm/2/queryUserInfo",type:"post",dataType:"json",data:{name:e.name,sex:e.sex,idType:e.paperstype,fromFlag:t,abc:useUserInfo.abc,mAbc:userinfoDetail.mAbc,alipayUid:a},beforeSend:function(e,t){this.url=apiUrl+this.url,layer.load(2)},success:function(e){if((confirm14day_flag=0)!=e.resCode||"0"!=e.resCode)106==e.resCode||"106"==e.resCode?($("#telnum").removeAttr("readonly"),$("#fill").removeClass("hide")):alert(e.resMessage+";code:A"+e.resCode);else if(e.res.phone&&(useUserInfo.qwe==userinfoDetail.qwe?(userinfoDetail.mobile=e.res.phone,userinfoDetail.mAbc=e.res.mAbc):(userinfoDetail.mobile=userinfoDetail.mobile,userinfoDetail.mAbc=userinfoDetail.mAbc),$("#telnum").val(e.res.phone),$("#childtelnum").val(e.res.phone)),useUserInfo.modified=e.res.commitCount,0==e.res.commitCount||(useUserInfo.id=e.res.id),e.res.exceed14Day)e.res.info?(e.res.info.current_location_code.length<=8?(useUserInfo.current_location="请选择",useUserInfo.current_location_code=""):(useUserInfo.current_location=e.res.info.current_location,useUserInfo.current_location_code=e.res.info.current_location_code),useUserInfo.current_address=e.res.info.current_address,useUserInfo.relation=e.res.info.relation):(useUserInfo.current_location="请选择",useUserInfo.current_location_code="",useUserInfo.current_address="",useUserInfo.relation=""),useUserInfo.qwe==userinfoDetail.qwe?$("#confirm14day_cancel").addClass("hide"):$("#confirm14day_cancel").removeClass("hide"),$("#confirm14day").removeClass("hide"),$("#codes").addClass("hide"),$("#confirm-name").text(e.res.name),useUserInfo.leveldata=decColor(e.res.level),useUserInfo.paperstype=e.res.idType;else{var t=e.res;useUserInfo.paperstype=e.res.idType,t.qrCode?(useUserInfo.leveldata=decColor(e.res.level),drwaCode(t,!0)):$("#fill").removeClass("hide")}},error:function(){alert("E012")},complete:function(){layer.closeAll("loading"),$(".title-pic").removeClass("hide")}})}function decColor(e){var t=CryptoJS.enc.Utf8.parse("kMB6D6T4uHE572QX"),a=CryptoJS.AES.decrypt(e,t,{mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7});return CryptoJS.enc.Utf8.stringify(a).toString().split(",")[0].toLowerCase()}function drwaCode(e,t){useUserInfo.name=e.name,useUserInfo.cardid=e.idcardNo,useUserInfo.abc=e.abc,useUserInfo.qwe=e.qwe,queryLatestHsFlag=0,$("#hs-footer").text("右滑刷新"),queryVaccQcFlag=0,$("#ym-footer").text("左滑刷新"),queryhsjc48(),queryYmStatus(),confirm14day_flag=0;var a=decColor(e.level);if(1==e.cityData)return $(".uncityData").addClass("hide"),$(".cityData").removeClass("hide"),!1;switch(queryTip(a),e.remainDays){case"1":case 1:$("#remainDays").text('你的苏康码 1 天内失效，请点击下方“信息更新"');break;case"2":case 2:$("#remainDays").text("你的苏康码 2 天内失效，请点击下方“信息更新”");break;default:$("#remainDays").empty()}e.info?(useUserInfo.current_address=e.info.current_address,useUserInfo.relation=e.info.relation,e.info.current_location_code.length<=8?(useUserInfo.current_location="请选择",useUserInfo.current_location_code=""):(useUserInfo.current_location_code=e.info.current_location_code,useUserInfo.current_location=e.info.current_location)):(useUserInfo.current_location="请选择",useUserInfo.current_location_code="",useUserInfo.current_address="",useUserInfo.relation=""),e.phone&&"null"!=e.phone&&($("#code-tel").text(e.phone),userinfoDetail.mobile=e.phone),$("#codes-text").html(""),$("#output").empty(),$(".commitTip").text("请谨慎填写，瞒报信息可能造成您的不便，甚至可能承担相关法律责任。"),$("#code-name").html(e.name),$("#code-id").text(e.idcardNo),$("#output").removeClass();var r=a,s="绿码";switch(r){case"yellow":s="黄码";break;case"red":s="红码";break;case"green":s="绿码"}$("#codecolor").text("·"+s),$("#output").attr("aria-label",s),"yellow"==a&&(a="#ffc00a");var o="https://h5.dingtalk.com/healthAct/index.html?qrCode="+e.qrCode+"&b="+e.scanFlag+"#/result";$("#output").qrcode({render:"canvas",text:o,width:"250",height:"250",foreground:a}),$("#now-time").html(format(e.currentTime)),currentTime=e.currentTime,function s(){timer&&clearTimeout(timer),timer=setTimeout(function(){if(collectTime){var e=Math.floor((new Date).getTime()/1e3),t=e<currentTime?currentTime:e;if($("#hs-layout").hasClass("hs48hours-border")||(collectTime=null),collectTime<t-172800){var a=new Date(collectTime),r=a.getFullYear()+"</br>"+add_zero(a.getMonth()+1)+"-"+add_zero(a.getDate());$("#hs-layout").removeClass("hs48hours-border"),$("#hs-content").html('\n\t\t\t\t\t<div class="hs-result">\n\t\t\t\t\t\t<div>阴性</div>\n\t\t\t\t\t\t<div>'.concat(r,"</div>\n\t\t\t\t\t</div> ")),collectTime=null}}currentTime+=1,$("#now-time").html(format(currentTime)),s()},1e3)}(),$("."+r).show(),$("#codes").removeClass("hide"),$("#reSubmit").removeClass("hide"),$("#rjmj").empty(),$("#jjgl").empty()}function queryTip(n){var e={level:n,abc:useUserInfo.abc};$.ajax({url:"/jkm/2/queryTip",type:"post",dataType:"json",data:e,beforeSend:function(e,t){$("#codes-text").html(""),this.url=apiUrl+this.url},success:function(e){if(0==e.resCode){var t;if(t="green"==n||"yellow"==n?"":"解除医学观察后联系所属街道/乡镇进行转码",$("#codes-text").html(t),e.res.track_matching,e.res.rxjjgl&&$("#jjgl").text("居家隔离仍须 "+e.res.rxjjgl+" 天"),e.res.rj_mj){var a="入境人员",r=e.res.rj_mj.crrq;a+="(入境时间："+(r=r.substr(0,4)+"-"+r.substr(4,2)+"-"+r.substr(6,2))+")",$("#rjmj").html(a)}var s=e.res.popUser;if(s){var o="　　【".concat(s.region,"市疫情防控指挥部】根据疫情防控政策，请您收到本提示后按本市规定频次进行核酸检测，并于24小时内完成一次采样。如未按规定执行，造成传染病传播扩散，将承担相应的法律责任。感谢您的理解和支持！咨询电话：").concat(s.popCall,"。\n\t\t\t\t\t");$("#tipModal").html(o),$("#myModal10").modal("show")}}}})}function queryCurrentInfo(){$.ajax({url:"/jkm/2/queryCurrentInfo",type:"post",dataType:"json",data:{abc:useUserInfo.abc},beforeSend:function(e){layer.load(2),this.url=apiUrl+this.url},success:function(e){0==e.resCode?drwaFillInfo(fillInfoObj=e.res):alert(e.resMessage)},complete:function(){layer.closeAll("loading")}})}function drwaFillInfo(e){$("#fillinfo-username").text(hideUserName(e.username)),$("#fillinfo-userid").text(e.userid),e.relation?($("#fill-child-grp").removeClass("hide"),$("#fill-parent-grp").addClass("hide"),$("#fillinfo-relation").text(e.relation)):($("#fill-child-grp").addClass("hide"),$("#fill-parent-grp").removeClass("hide"),$("#fillinfo-phone").text(e.phone)),$("#fillinfo-arrivalLocation").text(e.arrival_location),$("#fillinfo-currentLocation").text(e.current_location),$("#fillinfo-currentAddress").text(e.current_address),$("#fillinfo-r1data").text(showText(e.r1data)),$("#fillinfo-r2data").text(showText(e.r2data)),$("#fillinfo-r3data").text(showText(e.r3data)),$("#fillinfo-r3data").text(showText(e.r3data)),$("#fillinfo-r4data").text(showText(e.r4data)),$("#fillinfo-r6data").text(showText(e.r6data)),"0"==e.r6data||0==e.r6data?$("#fillinfo-r7dataGrp").addClass("hide"):($("#fillinfo-r7dataGrp").removeClass("hide"),$("#fillinfo-r7data").text(showText(e.r7data)))}$(function(){var e="xjp";"false"==e||"undefined"==e?(errorMsg="token= "+e+".errEnd",alert("E001:网络繁忙，请稍后重试。"),webClose()):""==e||null==e?login():verifyToken(e),$(".btn-outline-secondary").click(function(){$(this).parent(".pic").parent().addClass("hide"),$("#codes").removeClass("hide"),cancelEditPhone()})}),$(function(){$("#confirm14day_cancel").click(function(){$("#confirm14day").addClass("hide"),$("#codes").removeClass("hide")}),$("#confirm14day_btn").click(function(){if($("#confirm14day").addClass("hide"),confirm14day_flag=1,useUserInfo.qwe==userinfoDetail.qwe)$("#fill").removeClass("hide"),$("#trigger3").text(useUserInfo.current_location.replace(/,/g," ")),$("#currentLocation").val(useUserInfo.current_location),$("#currentLocationCode").val(useUserInfo.current_location_code),$("#currentAddress").val(useUserInfo.current_address);else{$("#childrenName").attr("readonly","readonly"),$("#childrenCardid").attr("readonly","readonly");var e=hideUserName(useUserInfo.name),t=useUserInfo.cardid;$("#childrenName").val(e),$("#childrenCardid").val(t),$("#children").removeClass("hide"),window.location.href="#children"}$.ajax({url:"/jkm/2/handle14DayData",type:"post",dataType:"json",data:{id:useUserInfo.id,leveldata:useUserInfo.leveldata,phone:useUserInfo.mobile,idType:useUserInfo.paperstype,userName:useUserInfo.name,abc:useUserInfo.abc,mAbc:userinfoDetail.mAbc},beforeSend:function(e,t){this.url=apiUrl+this.url},error:function(){alert("E012")}})})}),$(function(){$("#addChildBtn").click(function(){warning?$("#myModal7").modal("show"):queryFamily()}),$("#warning-confirm").click(function(){warning?($("#myModal7").modal("hide"),warning=!1,queryFamily()):($("#myModal7").modal("hide"),childInfoObj.editFlag=0,childInfoObj.cardid="",$("#childtrigger2").text("请选择"),$("#childtrigger3").text("请选择"),$("#childrenarrivalLocation").val(""),$("#childrenarrivalLocationCode").val(""),$("#childrencurrentLocation").val(""),$("#childrencurrentLocationCode").val(""),$("#childrencurrentAddress").val(""),$("#childrenName").removeAttr("readonly"),$("#childrenCardid").removeAttr("readonly"),$("#childrenName").val(""),$("#childrenCardid").val(""),$("#codes").addClass("hide"),$("#children").removeClass("hide"))}),$("#myModal1").on("click",".families",function(){var e=$(this).attr("data-relationVal"),t=$(this).attr("data-key");fillInfoObj="parent"==e?(fillInfoObj={},familyInfoObj.parent):(fillInfoObj={},familyInfoObj.children[t]);var a={name:$(this).attr("data-name"),sex:0,cardid:$(this).attr("data-cardid"),abc:$(this).attr("data-abc"),mobile:userinfoDetail.mobile,paperstype:$(this).attr("data-idtype"),qwe:$(this).attr("data-qwe")};$("#myModal1").modal("hide"),queryUserInfo(a)}),$("#myModal1").on("click",".unlock",function(e){e.stopPropagation();var t,a=$(this).attr("data-id"),r=$(this).parent("div").attr("data-cardid"),s=($(this).parent("div").attr("data-abc"),{name:$(this).parent("div").attr("data-name"),sex:0,cardid:$(this).parent("div").attr("data-cardid"),abc:$(this).parent("div").attr("data-abc"),mobile:userinfoDetail.mobile,paperstype:$(this).parent("div").attr("data-idtype"),id:a,delId:r});confirm("确认解除附属卡?")&&(t=s,$.ajax({url:"/jkm/2/queryUserInfo",type:"post",dataType:"json",data:{name:t.name,sex:t.sex,idType:t.paperstype,fromFlag:2,abc:t.abc,mAbc:userinfoDetail.mAbc,alipayUid:""},beforeSend:function(e,t){this.url=apiUrl+this.url,layer.load(2)},success:function(e){0!=e.resCode||"0"!=e.resCode?106==e.resCode||"106"==e.resCode||alert(e.resMessage+";code:A"+e.resCode):"green"!=decColor(e.res.level)?alert("码色异常，禁止解绑！"):deleteFamilyMember(t.id,t.delId,t.abc)},error:function(){alert("E022")},complete:function(){layer.closeAll("loading")}}))}),$("#reSubmit").click(function(){$("#myModal4").modal("show")}),$("#cityDataSubmit").click(function(){$("#codes").addClass("hide"),$("#fill").removeClass("hide"),$("#cancel").removeClass("hide")}),$("#hsjcBtn").click(function(){$("#codes").addClass("hide"),$("#hsjc").removeClass("hide"),queryHskt()}),$("#xgymBtn").click(function(){$("#codes").addClass("hide"),$("#xgym").removeClass("hide"),queryXgym()}),$("#xgymqgBtn").click(function(){$("#codes").addClass("hide"),$("#xgymqg").removeClass("hide"),$("#xgymqg-name").text(useUserInfo.name),$.ajax({url:"/healthCode/queryGjYm",type:"post",dataType:"json",data:{abc:useUserInfo.abc,userName:useUserInfo.name},beforeSend:function(e,t){this.url=apiUrl+this.url,layer.load(2)},success:function(e){if(0==e.resCode){var t=e.res.ymList;$("#xgymqg-time").text(format(e.res.currentTime));for(var a="",r=0;r<t.length;r++)a+='\n\t\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t\t<div class="field-label">疫苗名称：</div>\n\t\t\t\t\t\t\t<h6 class="text-right">'.concat(t[r].ymmc?t[r].ymmc:"",'</h6>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t\t<div class="field-label">接种地：</div>\n\t\t\t\t\t\t\t<h6 class="text-right">').concat(t[r].jzd?t[r].jzd:"",'</h6>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t\t<div class="field-label">生产企业：</div>\n\t\t\t\t\t\t\t<h6 class="text-right">').concat(t[r].scqy?t[r].scqy:"",'</h6>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t\t<div class="field-label">接种日期：</div>\n\t\t\t\t\t\t\t<h6 class="text-right">').concat(t[r].jzrq?t[r].jzrq:"","</h6>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<hr>");a+='<p class="hs-tip">数据来源：国家政务服务平台和国家卫生健康委员会。查询结果基于国家卫生健康委数据库，根据各地接种数据提供，正在不断汇聚更新中。</p>',$("#xgymqg-body").html(a)}else alert(e.resMessage)},complete:function(){layer.closeAll("loading")},error:function(){layer.closeAll("loading"),alert("E017")}})}),$("#xingchengBtn").click(function(){var e=window.navigator.userAgent.toLowerCase();-1!=e.indexOf("apxwebview")&&-1!=e.indexOf("aliapp")?my.postMessage({name:"jumpXcx",obj:{appid:"2019011763060066",path:"pages/journey-webview/journey-webview",extraData:{}}}):navigateToTripCard()}),$("#hsjcJSBtn").click(function(){window.location.href='detail.html';}),$("#goAdd").click(function(){$.ajax({url:"/jkm/2/queryClockInCount",type:"post",dataType:"json",data:{abc:useUserInfo.abc},beforeSend:function(e,t){this.url=apiUrl+this.url,layer.load(2)},success:function(e){var t=void 0;0==e.res.commitCount_day||"0"==e.res.commitCount_day?(t="每日分0点-12点，12-24点两个时间段可报备两次,请如实填写！",$("#reDaySubmit").removeClass("disabled")):(t="每日分0点-12点，12-24点两个时间段可报备两次,请如实填写！您当前时间段已报备。",$("#reDaySubmit").addClass("disabled")),$(".commitDayTip").html(t),$("#myModal5").modal("show")},complete:function(){layer.closeAll("loading")},error:function(){layer.closeAll("loading"),alert("E017")}})}),$("#reDatHis").click(function(){$("#myModal5").modal("hide"),$("#addHit").removeClass("hide"),$("#codes").addClass("hide"),queryAttendanceList()}),$("#queryInfoBtn").click(function(){$("#myModal4").modal("hide"),$("#fillInfo").removeClass("hide"),$("#codes").addClass("hide"),queryCurrentInfo()}),$("#reSubmitConf").click(function(){if($("#myModal4").modal("hide"),childInfoObj.editFlag=1,!$(this).hasClass("disabled"))if($("#codes").addClass("hide"),useUserInfo.qwe==userinfoDetail.qwe)$("#fill").removeClass("hide"),$("#cancel").removeClass("hide"),window.location.href="#fill",$("#trigger3").text(useUserInfo.current_location.replace(/,/g," ")),$("#currentLocation").val(useUserInfo.current_location),$("#currentLocationCode").val(useUserInfo.current_location_code),$("#currentAddress").val(useUserInfo.current_address),$("#telnum").val(userinfoDetail.mobile);else{$("#childtrigger3").text(useUserInfo.current_location.replace(/,/g," ")),$("#childrencurrentLocation").val(useUserInfo.current_location),$("#childrencurrentLocationCode").val(useUserInfo.current_location_code),$("#childrencurrentAddress").val(useUserInfo.current_address),$("#relationValue").val(useUserInfo.relation),$("#relationSelect").text(useUserInfo.relation),$("#childrenName").attr("readonly","readonly"),$("#childrenCardid").attr("readonly","readonly");var e=hideUserName(useUserInfo.name),t=useUserInfo.cardid;$("#childrenName").val(e),$("#childrenCardid").val(t),$("#children").removeClass("hide"),$(".child-pin-show").addClass("hide"),window.location.href="#children"}}),$("#reDaySubmit").click(function(){$(this).hasClass("disabled")||($("#codes").addClass("hide"),$("#add").removeClass("hide"),window.location.href="#add"),$("#myModal5").modal("hide")}),$("#famliyAddBtn").click(function(){$("#myModal7").modal("show"),$("#myModal1").modal("hide"),$(".child-pin-show").removeClass("hide"),$("#childrencurrentAddress").val(),$("#childPhone").val(""),$("#childPhone").removeAttr("readonly")})});var screenWidth=768<$(window).width()?768:$(window).width();$("#slider-sz").css("left",-screenWidth),$(window).resize(function(){var e=768<$(window).width()?768:$(window).width();screenWidth!=e&&(screenWidth=e,$("#slider-sz").css("left",-screenWidth),$("#slider-sz").removeClass().addClass("stop-center"))}),$("#slider-sz").on("touchstart",function(e){startX=e.originalEvent.changedTouches[0].pageX,startY=e.originalEvent.changedTouches[0].pageY}),$("#slider-sz").on("touchmove",function(e){if(moveEndX=e.originalEvent.changedTouches[0].pageX,moveEndY=e.originalEvent.changedTouches[0].pageY,X=moveEndX-startX,-40<(Y=moveEndY-startY)&&Y<40){var t=Number($("#slider-sz").css("left"))+X;20<X?$("#slider-sz").css("left",t+"px"):X<-20&&$("#slider-sz").css("left",t+"px")}else{var a=$("#slider-sz").attr("class");"stop-center"==a?$("#slider-sz").css("left",-screenWidth):"stop-right"==a?$("#slider-sz").css("left",2*-screenWidth):"stop-left"==a&&$("#slider-sz").css("left",0)}}),$("#slider-sz").on("touchend",function(e){moveEndX=e.originalEvent.changedTouches[0].pageX,moveEndY=e.originalEvent.changedTouches[0].pageY,X=moveEndX-startX,Y=moveEndY-startY;var t=$("#slider-sz").attr("class");-40<Y&&Y<40?50<X?"stop-center"==t?($("#slider-sz").removeClass().addClass("stop-left").animate({left:0}),queryLatestHs()):"stop-right"==t?$("#slider-sz").removeClass().addClass("stop-center").animate({left:-screenWidth}):"stop-left"==t&&$("#slider-sz").css("left",0):X<-50?"stop-center"==t?($("#slider-sz").removeClass().addClass("stop-right").animate({left:2*-screenWidth}),0==queryVaccQcFlag&&(queryXgym(),$("#ym-layout").hasClass("ym3-border")||queryVaccQc())):"stop-left"==t?$("#slider-sz").removeClass().addClass("stop-center").animate({left:-screenWidth}):"stop-right"==t&&$("#slider-sz").css("left",2*-screenWidth):"stop-center"==t?$("#slider-sz").animate({left:-screenWidth}):"stop-right"==t?$("#slider-sz").animate({left:2*-screenWidth}):"stop-left"==t&&$("#slider-sz").animate({left:0}):"stop-center"==t?$("#slider-sz").animate({left:-screenWidth}):"stop-right"==t?$("#slider-sz").animate({left:2*-screenWidth}):"stop-left"==t&&$("#slider-sz").animate({left:0})}),$("#hs-layout").click(function(){$("#slider-sz").removeClass().addClass("stop-left").animate({left:"0px"}),queryLatestHs()}),$("#ym-layout").click(function(){$("#slider-sz").removeClass().addClass("stop-right").animate({left:2*-screenWidth}),0==queryVaccQcFlag&&(queryXgym(),$("#ym-layout").hasClass("ym3-border")||queryVaccQc())}),$(".hs-goback , .ym-goback").click(function(){$("#slider-sz").removeClass().addClass("stop-center").animate({left:-screenWidth})});var is_czsm="";$("#czsm").click(function(){is_czsm?window.location.href=is_czsm:$.ajax({url:"/healthCode/queryOperatingInstructions",type:"post",dataType:"json",data:{abc:useUserInfo.abc},beforeSend:function(e,t){$("#codes-text").html(""),this.url=apiUrl+this.url},success:function(e){0==e.resCode?(is_czsm=e.res,window.location.href=is_czsm):alert(e.resMessage)}})});var newPhoneNum=null,oldPhoneNum=null;function cancelEditPhone(){$("#newPhone").val(""),$("#newPin").val(""),$("#newPhone").removeAttr("readOnly"),$("#checkPin").attr("disabled",!0),$("#newPhoneCheck").prop("checked",!1),newPhoneNum=null,userinfoDetail.mobile=oldPhoneNum||userinfoDetail.mobile}function saveInfo(){fillObj.abc=useUserInfo.abc,fillObj.id=useUserInfo.id,fillObj.modified=useUserInfo.modified,fillObj.leveldata=useUserInfo.leveldata,$.ajax({url:"/jkm/2/saveInfo",type:"post",dataType:"json",data:fillObj,beforeSend:function(e){$("#myModal3").modal("hide"),this.url=apiUrl+this.url,$("#fill").addClass("hide"),layer.load(2)},success:function(e){if((confirm14day_flag=0)!=e.resCode||"0"!=e.resCode)alert(e.resMessage+";codeB:"+e.resCode);else{var t=e.res;useUserInfo.id=t.id,useUserInfo.modified=t.commitCount,userinfoDetail.mAbc=e.res.mAbc,t.qrCode?drwaCode(t,!0):alert("生成二维码失败")}},complete:function(){layer.closeAll("loading")}})}function myModal3Show(e){$("#myModal3").modal("show"),$("#grp_1Text").text(e.arrivalLocation),$("#grp_2Text").text(e.currentLocation),$("#grp_3Text").text(e.currentAddress),showModalText("grp_6Text",e.r3data),showModalText("grp_7Text",e.r4data),showModalText("grp_8Text",e.r6data),$("#grp_10Text").text(hideUserName(e.name)),$("#grp_11Text").text(useUserInfo.cardid),$("#grp_12Text").text($("#telnum").val()),"1"==e.r6data?($("#grp_9Group").removeClass("hide"),showModalText("grp_9Text",e.r7data)):$("#grp_9Group").addClass("hide")}function queryFamily(){$.ajax({url:"/jkm/2/queryFamily",type:"post",dataType:"json",data:{abc:userinfoDetail.abc},beforeSend:function(e){$(".families").remove(),this.url=apiUrl+this.url,layer.load(2)},success:function(e){if($("#myModal1").modal("show"),0==e.resCode){familyInfoObj=e.res,userinfoDetail.arrival_location=familyInfoObj.parent.arrival_location,userinfoDetail.current_address=familyInfoObj.parent.current_address,userinfoDetail.current_location=familyInfoObj.parent.current_location,userinfoDetail.current_location_code=familyInfoObj.parent.current_location_code,userinfoDetail.arrival_location_code=familyInfoObj.parent.arrival_location_code;var a=showfamliyInfo(familyInfoObj.parent.username,familyInfoObj.parent.userid,"主卡","parent",0,0,0,userinfoDetail.abc,userinfoDetail.qwe,userinfoDetail.paperstype);familyInfoObj.children?(familyInfoObj.children.forEach(function(e,t){a+=showfamliyInfo(e.username,e.userid,e.relation,"child",t,e.id,familyInfoObj.deleteCount,e.abc,e.qwe,e.idtype,e.leveldata)}),$("#famliyAddBtn").before(a),4<=familyInfoObj.children.length?$("#famliyAddBtn").addClass("hide"):$("#famliyAddBtn").removeClass("hide")):$("#famliyAddBtn").before(a)}else alert(e.resMessage)},complete:function(){layer.closeAll("loading")}})}function myModal2Show(e){$("#myModal2").modal("show"),$("#childrengrp_1Text").text(hideUserName(e.name)),$("#childrengrp_2Text").text(e.cardid),$("#childrengrp_3Text").text(e.relation),$("#childrengrp_4Text").text(e.arrivalLocation),$("#childrengrp_5Text").text(e.currentLocation),$("#childrengrp_6Text").text(e.currentAddress),$("#childrengrp_13Text1").text($("#childPhone").val()),$("#childrengrp_13Text2").text($("#childPin").val()),showModalText("childrengrp_9Text",e.r3data),showModalText("childrengrp_10Text",e.r4data)}function saveFamilyMember(){0==childInfoObj.editFlag?(childInfoObj.lastId="",childInfoObj.id="",childInfoObj.abc="",childInfoObj.leveldata=""):(childInfoObj.lastId=fillInfoObj.id,childInfoObj.id=useUserInfo.id,childInfoObj.abc=useUserInfo.abc,childInfoObj.leveldata=useUserInfo.leveldata),childInfoObj.parentAbc=userinfoDetail.abc,childInfoObj.mAbc=userinfoDetail.mAbc,childInfoObj.modified=useUserInfo.modified,$.ajax({url:"/jkm/2/saveFamilyMember_js",type:"post",dataType:"json",data:childInfoObj,beforeSend:function(e){this.url=apiUrl+this.url,layer.load(2)},success:function(e){if(0!=e.resCode||"0"!=e.resCode)114==e.resCode?confirm(e.resMessage)&&(childInfoObj.otherProvince=1,saveFamilyMember()):($("#myModal2").modal("hide"),alert(e.resMessage));else{var t=e.res;useUserInfo.modified=t.commitCount,useUserInfo.id=t.id,$("#myModal2").modal("hide"),$("#children").addClass("hide"),$(".gwyxckcx").addClass("hide"),t.qrCode?(drwaCode(t,!0),childInfoObj.otherProvince=0):alert("生成二维码失败")}},complete:function(){layer.closeAll("loading")}})}function deleteFamilyMember(e,t,a){$.ajax({url:"/jkm/2/deleteFamilyMember",type:"post",dataType:"json",data:{id:e,parentAbc:userinfoDetail.abc,abc:a},beforeSend:function(e){$("#myModal1").modal("hide"),this.url=apiUrl+this.url,layer.load(2)},success:function(e){0==e.resCode?queryUserInfo({name:userinfoDetail.name,cardid:userinfoDetail.cardid,sex:userinfoDetail.sex,paperstype:userinfoDetail.paperstype,mobile:userinfoDetail.mobile,abc:userinfoDetail.abc,qwe:userinfoDetail.qwe},1):alert(e.resMessage)},complete:function(){layer.closeAll("loading")}})}function showfamliyInfo(e,t,a,r,s){var o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"",n=(6<arguments.length&&void 0!==arguments[6]&&arguments[6],7<arguments.length?arguments[7]:void 0),l=8<arguments.length?arguments[8]:void 0,i=9<arguments.length?arguments[9]:void 0;return(10<arguments.length&&void 0!==arguments[10]&&arguments[10],'<div class="families" data-cardid="'+t+'" data-name="'+e+'" data-relationVal="'+r+'" data-key='+s+" data-id="+o+" data-abc="+n+"  data-qwe="+l+" data-idtype="+i+">")+'<p class="famliy-name"><span>'+hideUserName(e)+"</span><span>"+a+'</span></p><p class="famliy-id"><span>证件号码</span><span class="famliy-parent-value">'+t+"</span></p></div>"}function saveDailyAttendance(){addInfoObj.abc=useUserInfo.abc,$.ajax({url:"/jkm/2/saveRiskReport",type:"post",dataType:"json",data:addInfoObj,beforeSend:function(e){layer.load(2),$("#myModal6").modal("hide"),this.url=apiUrl+this.url},success:function(e){0==e.resCode?(layer.msg("报备成功"),$("#reDaySubmit").addClass("disabled"),$(".commitDayTip").html("每日分0点-12点，12-24点两个时间段可报备两次,请如实填写！您当前时间段已报备。"),$("#add").addClass("hide"),$("#codes").removeClass("hide")):alert("报备失败")},complete:function(){layer.closeAll("loading")}})}function myModal6Show(e){$("#myModal6").modal("show"),showModalText("addgrp_1Text",e.degree_flag),showModalText("addgrp_2Text",e.r1data),showModalText("addgrp_3Text",e.r2data),showModalText("addgrp_4Text",e.r3data),showModalText("addgrp_5Text",e.r4data),$("#addgrp_6Text").text(e.other?e.other:"---")}function queryAttendanceList(){$.ajax({url:"/jkm/2/queryRiskReportList",type:"post",dataType:"json",data:{abc:useUserInfo.abc},beforeSend:function(e){layer.load(2),this.url=apiUrl+this.url},success:function(e){if(0==e.resCode){var t;t=0<e.res.list.length?showaddHisHtml(e.res.list):'<div class="panel panel-default"><div class="panel-heading text-center"><div href="#" >暂无信息</div></div></div>',$("#accordion").html(t)}else alert(e.resMessage)},complete:function(){layer.closeAll("loading")}})}function showaddHisHtml(e){var a="";return e.forEach(function(e,t){a+='<div class="panel panel-default"><div class="panel-heading"><div data-toggle="collapse" data-parent="#accordion" href="#collapseOne'+t+'">'+getTime(e.createtime)+'<span class="addhitlisticon"></span></div></div><div id="collapseOne'+t+'"" class="panel-collapse collapse in"><div class="panel-body"><div class="modal-body"><div class="form-group"><div class="field-label">体温是否超过37.3℃</div><h6 class="text-right">'+showText(e.degree_flag)+'</h6></div><div class="form-group"><div class="field-label">是否入境未满28天</div><h6 class="text-right">'+showText(e.r1data)+'</h6></div><div class="form-group"><div class="field-label">是否有7天内国内中高风险地区旅居史</div><h6 class="text-right">'+showText(e.r2data)+'</h6></div><div class="form-group"><div class="field-label">是否有江苏需管控地区旅居史</div><h6 class="text-right">'+showText(e.r3data)+'</h6></div><div class="form-group"><div class="field-label">本人联系号码</div><h6 class="text-right" >'+(e.other?e.other:"---")+"</h6></div></div></div></div></div>"}),a}$(function(){$("#isgrp_8").click(function(){$("#grp_9").removeClass("hide")}),$("#unGrp_8").click(function(){$("#grp_9").addClass("hide")}),$(".ui-radio2").click(function(){var e=$(this).find(".jqradiowrapper").find(".jqradio");e.hasClass("jqchecked")?e.removeClass("jqchecked"):e.addClass("jqchecked")});var e=document.getElementById("telnum");e.onchange=function(){/^1\d{10}$/.test(e.value)?($("#grp_12").removeClass("choose"),userinfoDetail.mobile=e.value):$("#grp_12").addClass("choose")},$("#getcode").click(function(){var e=1;checkPhone($("#telnum").val().replace(/\s*/g,""))||($("#grp_12").addClass("choose"),1==e&&(window.location.href="#grp_12"),$("#telnum").removeAttr("readonly"),layer.msg("输入正确的手机号"),e=0);var t=getUrlParam("uid");if(t){var a=t.substr(0,1);"p"!=a&&"P"!=a||(t="")}else t="";if((fillObj={name:userinfoDetail.name,sex:userinfoDetail.sex,mobile:userinfoDetail.mobile,mAbc:userinfoDetail.mAbc,idType:userinfoDetail.paperstype,source:source,alipayUid:t,realtimeLocation:realtimeLocation,tokenMiss:"",arrivalLocation:$("#arrivalLocation").val().replace(/\s*/g,""),currentLocation:$("#currentLocation").val().replace(/\s*/g,""),currentAddress:setNewVal($("#currentAddress").val()),arrivalLocationCode:$("#arrivalLocationCode").val(),currentLocationCode:$("#currentLocationCode").val(),r1data:0,r2data:0,r3data:$("#grp_6 .jqchecked").attr("value"),r4data:$("#grp_7 .jqchecked").attr("value"),r6data:$("#grp_8 .jqchecked").attr("value"),r7data:0}).arrivalLocation||($("#grp_1").addClass("choose"),1==e&&(window.location.href="#grp_1"),e=0),fillObj.currentLocation&&"请选择"!=fillObj.currentLocation||($("#grp_2").addClass("choose"),1==e&&(window.location.href="#grp_2"),e=0),fillObj.currentAddress||($("#grp_3").addClass("choose"),1==e&&(window.location.href="#grp_3"),e=0),"0"!=fillObj.r3data&&"1"!=fillObj.r3data&&($("#grp_6").addClass("choose"),1==e&&(window.location.href="#grp_6"),e=0),"0"!=fillObj.r4data&&"1"!=fillObj.r4data&&($("#grp_7").addClass("choose"),1==e&&(window.location.href="#grp_7"),e=0),"0"!=fillObj.r6data&&"1"!=fillObj.r6data&&($("#grp_8").addClass("choose"),1==e&&(window.location.href="#grp_8"),e=0),1==fillObj.r6data?(fillObj.r7data=$("#grp_9 .jqchecked").attr("value"),"0"!=fillObj.r7data&&"1"!=fillObj.r7data&&($("#grp_9").addClass("choose"),1==e&&(window.location.href="#grp_9"),e=0)):fillObj.r7data=0,1==e&&($(".ui-radio2").find(".jqradiowrapper").find(".jqradio").hasClass("jqchecked")||(layer.msg("请勾选本人知情同意"),1==e&&(window.location.href="#grp_14"),e=0)),0==e)return!1;myModal3Show(fillObj)}),$("#fillSubmit").click(function(){saveInfo(),newPhoneNum&&$.ajax({url:"/healthCode/phoneRecord",type:"post",dataType:"json",data:{abc:useUserInfo.abc,phone:newPhoneNum},beforeSend:function(e){this.url=apiUrl+this.url,layer.load(2)},success:function(e){0==e.resCode&&"0"==e.resCode||alert(e.resMessage+";codeB:"+e.resCode)},complete:function(){layer.closeAll("loading")}})}),$("#editPhoneNum").click(function(){$("#newPhone").val(""),$("#newPin").val(""),$("#newPhone").removeAttr("readOnly"),$("#checkPin").attr("disabled",!0),$("#newPhoneCheck").prop("checked",!1),oldPhoneNum=userinfoDetail.mobile,$.ajax({url:"/healthCode/modifyPhoneRule",type:"post",dataType:"json",data:{abc:useUserInfo.abc},beforeSend:function(e){this.url=apiUrl+this.url,layer.load(2)},success:function(e){0!=e.resCode||"0"!=e.resCode?alert(e.resMessage):$("#myModal9").modal("show")},complete:function(){layer.closeAll("loading")}})});var t=null,a=60;$("#getNewPin").click(function(){var e=$("#newPhone").val();return/^1\d{10}$/.test(e)?!$("#getNewPin").hasClass("disabled")&&(clearInterval(t),a=60,void("获得验证码"==$("#getNewPin").text()&&($("#newPhone").attr("readOnly","true"),$("#getNewPin").addClass("disabled"),$("#getNewPin").text("60秒"),t=setInterval(function(){a--,$("#getNewPin").text(a+"秒"),a<=0&&(clearInterval(t),$("#getNewPin").removeClass("disabled"),$("#getNewPin").text("获得验证码"),a=60)},1e3),$.ajax({url:"/healthCode/queryModifyPhoneYzm",type:"post",dataType:"json",data:{abc:useUserInfo.abc,oldMAbc:userinfoDetail.mAbc,newPhone:e},beforeSend:function(e,t){this.url=apiUrl+this.url},success:function(e){0==e.resCode?($("#newPin").focus(),layer.msg("短信发送中，请注意查收")):(cancelEditPhone(),clearInterval(t),$("#getNewPin").removeClass("disabled"),$("#getNewPin").text("获得验证码"),a=60,$("#newPhone").focus(),alert(e.resMessage))}})))):(alert("请输入正确的手机号"),!1)}),$("#checkPin").click(function(){var t=$("#newPhone").val(),e=$("#newPin").val();return/^1\d{10}$/.test(t)?6!=e.length?(alert("请输入6位验证码"),!1):void $.ajax({url:"/healthCode/checkModifyPhoneYzm",type:"post",dataType:"json",data:{abc:useUserInfo.abc,yzm:e},beforeSend:function(e,t){this.url=apiUrl+this.url},success:function(e){0==e.resCode?(newPhoneNum=t,$("#telnum").val(newPhoneNum),$("#myModal9").modal("hide"),userinfoDetail.mobile=newPhoneNum):(cancelEditPhone(),$("#newPhone").focus(),alert(e.resMessage))}}):(alert("请输入正确的手机号"),!1)}),$("#cancelEditPhone").click(function(){cancelEditPhone(),$("#myModal9").modal("hide")}),$("#myModal9").on("hidden.bs.modal",function(e){$("#newPhone").val(""),$("#newPin").val(""),$("#newPhone").removeAttr("readOnly"),$("#checkPin").attr("disabled",!0),$("#newPhoneCheck").prop("checked",!1)}),$("#newPhoneCheck").change(function(){$(this).prop("checked")?$("#checkPin").removeAttr("disabled"):$("#checkPin").attr("disabled",!0)})}),$(function(){$("#ischildrengrp_8").click(function(){$("#childrengrp_9").removeClass("hide")}),$("#unchildrenGrp_8").click(function(){$("#childrengrp_9").addClass("hide")}),$("#childrenGetCode").click(function(){var e=1;if(1==childInfoObj.editFlag)childInfoObj.name=useUserInfo.name,childInfoObj.cardid=useUserInfo.cardid,childInfoObj.r8data="";else{var t=$("#childrenName").val().replace(/\s*/g,"");t?childInfoObj.name=t:($("#childrengrp_10").addClass("choose"),1==e&&(window.location.href="#childrengrp_10"),layer.msg("请完成正确的实名认证"),e=0);var a=$("#childrenCardid").val().replace(/\s*/g,"").toUpperCase();isIdCardNo(a)?childInfoObj.cardid=a:($("#childrengrp_11").addClass("choose"),1==e&&(window.location.href="#childrengrp_11"),layer.msg("请输入正确的身份证号"),e=0);var r=$("#childPhone").val(),s=$("#childPin").val();/^1\d{10}$/.test(r)?6!=s.length&&($("#childrengrp_13").addClass("choose"),1==e&&(window.location.href="#childrengrp_13"),e=0):($("#childrengrp_13").addClass("choose"),1==e&&(window.location.href="#childrengrp_13"),e=0),childInfoObj.r8data=$("#childPhone").val()}var o=$("#relationValue").val();o||($("#childrengrp_12").addClass("choose"),1==e&&(window.location.href="#childrengrp_12"),e=0);var n="xjp";if(n){var l=n.substr(0,1);"p"!=l&&"P"!=l||(n="")}else n="";if(childInfoObj.sex=0,childInfoObj.relation=o,childInfoObj.mobile=userinfoDetail.mobile,childInfoObj.idType=1,childInfoObj.source=source,childInfoObj.alipayUid="",childInfoObj.realtimeLocation=realtimeLocation,childInfoObj.tokenMiss="",childInfoObj.arrivalLocation=$("#childrenarrivalLocation").val().replace(/\s*/g,""),childInfoObj.currentLocation=$("#childrencurrentLocation").val().replace(/\s*/g,""),childInfoObj.currentAddress=setNewVal($("#childrencurrentAddress").val()),childInfoObj.arrivalLocationCode=$("#childrenarrivalLocationCode").val(),childInfoObj.currentLocationCode=$("#childrencurrentLocationCode").val(),childInfoObj.arrivalLocation||($("#childrengrp_1").addClass("choose"),1==e&&(window.location.href="#childrengrp_1"),e=0),childInfoObj.currentLocation&&"请选择"!=childInfoObj.currentLocation||($("#childrengrp_2").addClass("choose"),1==e&&(window.location.href="#childrengrp_2"),e=0),childInfoObj.currentAddress||($("#childrengrp_3").addClass("choose"),1==e&&(window.location.href="#childrengrp_3"),e=0),childInfoObj.r1data=0,childInfoObj.r2data=0,childInfoObj.r3data=$("#childrengrp_6 .jqchecked").attr("value"),childInfoObj.r4data=$("#childrengrp_7 .jqchecked").attr("value"),childInfoObj.r6data=0,childInfoObj.r7data=0,"0"!=childInfoObj.r3data&&"1"!=childInfoObj.r3data&&($("#childrengrp_6").addClass("choose"),1==e&&(window.location.href="#childrengrp_6"),e=0),"0"!=childInfoObj.r4data&&"1"!=childInfoObj.r4data&&($("#childrengrp_7").addClass("choose"),1==e&&(window.location.href="#childrengrp_7"),e=0),0==e)return!1;myModal2Show(childInfoObj)});var t=null,a=60;$("#getChildPin").click(function(){var e=$("#childPhone").val();return/^1\d{10}$/.test(e)?!$("#getChildPin").hasClass("disabled")&&(clearInterval(t),a=60,void("获得验证码"==$("#getChildPin").text()&&($("#childPhone").attr("readOnly","true"),$("#getChildPin").addClass("disabled"),$("#getChildPin").text("60秒"),t=setInterval(function(){a--,$("#getChildPin").text(a+"秒"),a<=0&&(clearInterval(t),$("#getChildPin").removeClass("disabled"),$("#getChildPin").text("获得验证码"),a=60)},1e3),$.ajax({url:"/healthCode/queryChildYzm",type:"post",dataType:"json",data:{abc:useUserInfo.abc,phone:e},beforeSend:function(e,t){this.url=apiUrl+this.url},success:function(e){0==e.resCode?($("#childPin").focus(),layer.msg("短信发送中，请注意查收")):(clearInterval(t),$("#getChildPin").removeClass("disabled"),$("#getChildPin").text("获得验证码"),a=60,$("#childPhone").focus(),alert(e.resMessage))}})))):(alert("请输入正确的手机号"),!1)}),$("#saveFamilyMember").click(function(){1==childInfoObj.editFlag?saveFamilyMember():$.ajax({url:"/healthCode/checkChildYzm",type:"post",dataType:"json",data:{abc:useUserInfo.abc,yzm:$("#childPin").val()},beforeSend:function(e,t){this.url=apiUrl+this.url},success:function(e){0==e.resCode?saveFamilyMember():alert(e.resMessage)}})})}),$(function(){$("#isaddgrp_5").click(function(){$("#addgrp_6").removeClass("hide"),$("#addgrp_7").removeClass("hide"),$("#addgrp_8").removeClass("hide"),$("#addgrp_9").removeClass("hide")}),$("#unaddgrp_5").click(function(){$("#addgrp_6").addClass("hide"),$("#addgrp_7").addClass("hide"),$("#addgrp_8").addClass("hide"),$("#addgrp_9").addClass("hide")}),$("#addSave").click(function(){var e=1;if((addInfoObj={name:useUserInfo.name,sex:useUserInfo.sex,mobile:userinfoDetail.mobile,idType:userinfoDetail.paperstype,degree:$("#degree").text(),realtimeLocation:realtimeLocation,source:source}).degree_flag=$("#addgrp_1 .jqchecked").attr("value"),addInfoObj.r1data=$("#addgrp_2 .jqchecked").attr("value"),addInfoObj.r2data=$("#addgrp_3 .jqchecked").attr("value"),addInfoObj.r3data=$("#addgrp_4 .jqchecked").attr("value"),addInfoObj.r4data=$("#addgrp_5 .jqchecked").attr("value"),addInfoObj.other=$("#addTelnum").val(),"0"!=addInfoObj.degree_flag&&"1"!=addInfoObj.degree_flag&&($("#addgrp_1").addClass("choose"),1==e&&(window.location.href="#addgrp_1"),e=0),"0"!=addInfoObj.r1data&&"1"!=addInfoObj.r1data&&($("#addgrp_2").addClass("choose"),1==e&&(window.location.href="#addgrp_2"),e=0),"0"!=addInfoObj.r2data&&"1"!=addInfoObj.r2data&&($("#addgrp_3").addClass("choose"),1==e&&(window.location.href="#addgrp_3"),e=0),"0"!=addInfoObj.r3data&&"1"!=addInfoObj.r3data&&($("#addgrp_4").addClass("choose"),1==e&&(window.location.href="#addgrp_4"),e=0),"0"!=addInfoObj.r4data&&"1"!=addInfoObj.r4data&&($("#addgrp_5").addClass("choose"),1==e&&(window.location.href="#addgrp_5"),e=0),addInfoObj.other&&(checkPhone2(addInfoObj.other)||($("#addgrp_6").addClass("choose"),1==e&&(window.location.href="#addgrp_6"),e=0,layer.msg("请输入正确的手机号"))),0==e)return!1;myModal6Show(addInfoObj)}),$("#addSubmit").click(function(){saveDailyAttendance()})});var xcmtimer=null,countXc=60;function jkmqueryXc(){$.ajax({url:"/jkm/2/queryXc",type:"post",dataType:"json",data:{abc:useUserInfo.abc},beforeSend:function(e,t){this.url=apiUrl+this.url},success:function(e){"-1"==e.res.value?$(".gwyxck-btn").removeClass("hide"):"0"==e.res.value?($(".gwyxck-btns").addClass("hide"),$(".gwyxck-tip1").removeClass("hide")):"1"==e.res.value&&($(".gwyxck-btns").addClass("hide"),$(".gwyxck-tip2").removeClass("hide"))}})}function jkmCheckXcYzm(e){$.ajax({url:"/jkm/2/checkXcYzm",type:"post",dataType:"json",data:{abc:useUserInfo.abc,mAbc:userinfoDetail.mAbc,yzm:e},beforeSend:function(e,t){this.url=apiUrl+this.url,layer.load(2)},success:function(e){0==e.resCode?("0"==e.res.value?($(".gwyxck-btns").addClass("hide"),$(".gwyxck-tip1").removeClass("hide")):"1"==e.res.value&&($(".gwyxck-btns").addClass("hide"),$(".gwyxck-tip2").removeClass("hide")),$("#myModal8").modal("hide"),$(".gwyxck-btn").addClass("hide")):alert(e.resMessage)},complete:function(){layer.closeAll("loading")}})}function queryHskt2(){$.ajax({url:"/jkm/2/queryGjm",type:"post",dataType:"json",data:{name:useUserInfo.name,abc:useUserInfo.abc},beforeSend:function(e,t){this.url=apiUrl+this.url,layer.load(2),$("#hscj-name").text(useUserInfo.name),$(".hs-data").addClass("hide"),$(".kt-data").addClass("hide")},success:function(e){if(0==e.resCode){var t=e.res.data.hsjc;$("#hscj-time").text(format(e.res.currentTime)),$.isEmptyObject(t)?($(".hs-data").addClass("hide"),$("#hs").text("暂未查询到数据")):($("#hs").text("是"),$(".hs-data").removeClass("hide"),$("#hsjcjg").text(t.hsjcjg),$("#hsjcjgmc").text(t.hsjcjgmc),$("#hsjcsj").text(t.hsjcsj));var a=e.res.data.ktjc;$.isEmptyObject(a)?($(".kt-data").addClass("hide"),$("#kt").text("暂未查询到数据")):($("#kt").text("是"),$(".kt-data").removeClass("hide"),$("#ktjcjg").text(a.ktjcjg),$("#ktjcjgmc").text(a.ktjcjgmc),$("#ktjcsj").text(a.ktjcsj))}else alert(e.resMessage)},complete:function(){layer.closeAll("loading")},error:function(){alert("E015:网络繁忙,请稍后再试")}})}function queryHskt(){$.ajax({url:"/jkm/2/queryHskt",type:"post",dataType:"json",data:{userName:useUserInfo.name,abc:useUserInfo.abc},beforeSend:function(e,t){this.url=apiUrl+this.url,layer.load(2),$("#hscj-name").text(useUserInfo.name),$(".hs-data").addClass("hide"),$(".kt-data").addClass("hide")},success:function(e){if(0==e.resCode){var t=e.res.hs.data;$("#hscj-time").text(format(e.res.currentTime)),t?($("#hs").text("是"),$(".hs-data").removeClass("hide"),$("#hsjcjg").text(t.hsjcjg),$("#hsjcjgmc").text(t.hsjcjgmc),$("#hsjcsj").text(t.hsjcsj)):($(".hs-data").addClass("hide"),$("#hs").text("暂未查询到数据"));var a=e.res.kt.data;a?($("#kt").text("是"),$(".kt-data").removeClass("hide"),$("#ktjcjg").text(a.ktjcjg),$("#ktjcjgmc").text(a.ktjcjgmc),$("#ktjcsj").text(a.ktjcsj)):($(".kt-data").addClass("hide"),$("#kt").text("暂未查询到数据"))}else alert(e.resMessage)},complete:function(){layer.closeAll("loading")},error:function(){alert("E016:网络繁忙,请稍后再试")}})}function queryhsjc48(){$.ajax({url:"/healthCode/queryHs",type:"post",dataType:"json",data:{name:useUserInfo.name,abc:useUserInfo.abc},beforeSend:function(e,t){$("#hs-layout").removeClass("hs48hours-border"),$("#hs-list").html('\n\t\t\t\t<div>&nbsp;</div>\n\t\t\t\t<div style="text-align: center;color: #9d9d9d;">&nbsp;</div>\n\t\t\t\t<div>&nbsp;</div>\n\t\t\t'),$("#hs-content").html('<div class="no-hsym">暂未查询到数据</div>'),this.url=apiUrl+this.url},success:function(e){if(0==e.resCode)if(e.res.hs){if(collectTime=Math.floor(new Date(e.res.hs.collectTime.replace(/-/g,"/")).getTime()/1e3),e.res.currentTime-172800<collectTime)$("#hs-content").html('\n\t\t\t\t\t\t\t<div class="hs48hours">\n\t\t\t\t\t\t\t\t<div>48</div>\n\t\t\t\t\t\t\t\t<div>小时</br>阴性</div>\n\t\t\t\t\t\t\t</div>  '),$("#hs-layout").addClass("hs48hours-border");else{$("#hs-layout").removeClass("hs48hours-border"),collectTime=null;var t=e.res.hs.collectTime.substr(0,4)+"</br>"+e.res.hs.collectTime.substr(5,5);$("#hs-content").html('\n\t\t\t\t\t\t<div class="hs-result">\n\t\t\t\t\t\t\t<div>阴性</div>\n\t\t\t\t\t\t\t<div>'.concat(t,"</div>\n\t\t\t\t\t\t</div> "))}$("#hs-list").html("\n\t\t\t\t\t\t<div><span>采样点：</span><span>".concat(e.res.hs.collectUnit,"</span></div>\n\t\t\t\t\t\t<div><span>检测时间：</span><span>").concat(e.res.hs.collectTime,'</span></div>\n\t\t\t\t\t\t<div><span>检测结果：</span><span style="font-weight: bold;color: rgb(0, 201, 2);">阴性</span></div>\n\t\t\t\t\t'))}else collectTime=null,$("#hs-layout").removeClass("hs48hours-border"),$("#hs-list").html('\n\t\t\t\t\t\t<div>&nbsp;</div>\n\t\t\t\t\t\t<div style="text-align: center;color: #9d9d9d;">暂未查询到数据</div>\n\t\t\t\t\t\t<div>&nbsp;</div>\n\t\t\t\t\t'),$("#hs-content").html('<div class="no-hsym">暂未查询到数据</div>');else alert(e.resMessage)},error:function(){$("#hs-layout").removeClass("hs48hours-border"),alert("E018:网络繁忙,请稍后再试")}})}function queryLatestHs(){0==queryLatestHsFlag&&$.ajax({url:"/healthCode/queryLatestHs",type:"post",dataType:"json",data:{name:useUserInfo.name,abc:useUserInfo.abc,idType:useUserInfo.paperstype},beforeSend:function(e,t){this.url=apiUrl+this.url,layer.load(2)},success:function(e){if(0==e.resCode){if(e.res.hs){if(collectTime=Math.floor(new Date(e.res.hs.collectTime.replace(/-/g,"/")).getTime()/1e3),e.res.currentTime-172800<collectTime)$("#hs-content").html('\n\t\t\t\t\t\t\t\t<div class="hs48hours">\n\t\t\t\t\t\t\t\t\t<div>48</div>\n\t\t\t\t\t\t\t\t\t<div>小时</br>阴性</div>\n\t\t\t\t\t\t\t\t</div>  '),$("#hs-layout").addClass("hs48hours-border");else{$("#hs-layout").removeClass("hs48hours-border"),collectTime=null;var t=e.res.hs.collectTime.substr(0,4)+"</br>"+e.res.hs.collectTime.substr(5,5);$("#hs-content").html('\n\t\t\t\t\t\t\t<div class="hs-result">\n\t\t\t\t\t\t\t\t<div>阴性</div>\n\t\t\t\t\t\t\t\t<div>'.concat(t,"</div>\n\t\t\t\t\t\t\t</div> "))}$("#hs-list").html("\n\t\t\t\t\t\t\t<div><span>采样点：</span><span>".concat(e.res.hs.collectUnit,"</span></div>\n\t\t\t\t\t\t\t<div><span>检测时间：</span><span>").concat(e.res.hs.collectTime,'</span></div>\n\t\t\t\t\t\t\t<div><span>检测结果：</span><span style="font-weight: bold;color: rgb(0, 201, 2);">阴性</span></div>\n\t\t\t\t\t\t'))}else collectTime=null,$("#hs-list").html('\n\t\t\t\t\t\t\t<div>&nbsp;</div>\n\t\t\t\t\t\t\t<div style="text-align: center;color: #9d9d9d;">暂未查询到数据</div>\n\t\t\t\t\t\t\t<div>&nbsp;</div>\n\t\t\t\t\t\t'),$("#hs-layout").removeClass("hs48hours-border"),$("#hs-content").html('<div class="no-hsym">暂未查询到数据</div>');queryLatestHsFlag=1,$("#hs-footer").text("右滑查看")}else alert(e.resMessage),queryLatestHsFlag=0},complete:function(){layer.closeAll("loading")},error:function(){$("#hs-layout").removeClass("hs48hours-border"),alert("E019:网络繁忙,请稍后再试")}})}function queryXgym(){$.ajax({url:"/jkm/2/queryVaccine",type:"post",dataType:"json",data:{userName:useUserInfo.name,abc:useUserInfo.abc},beforeSend:function(e,t){this.url=apiUrl+this.url,layer.load(2)},success:function(e){if(0==e.resCode){var t=e.res.data;$("#xgym-time").text(format(e.res.currentTime));var a="";if($.isEmptyObject(t))a+='<div class="form-group border-bottom"><h6 class="text-center">暂未查询到数据</h6></div>';else for(var r in t){var s=t[r];a+='<div class="form-group ym-inline"><span class="field-label">疫苗名称：</span><span >'+s.bactName+'</span></div><div class="form-group ym-inline"><span class="field-label">接种日期：</span><span>'+s.inocDate+'</span></div><div class="form-group ym-inline border-bottom"><span class="field-label">接种单位：</span><span>'+s.inocUnit+"</span></div>"}queryVaccQcFlag=1,$(".xgym-modal").html(a)}else alert(e.resMessage),queryVaccQcFlag=0},complete:function(){layer.closeAll("loading")},error:function(){alert("E020:网络繁忙,请稍后再试")}})}function queryYmStatus(){$.ajax({url:"/healthCode/queryYmStatus",type:"post",dataType:"json",data:{userName:useUserInfo.name,abc:useUserInfo.abc},beforeSend:function(e,t){$("#ym-layout").removeClass("ym2-border").removeClass("ym3-border"),$("#ym-content").html('<div class="no-hsym">&nbsp;</div>'),this.url=apiUrl+this.url},success:function(e){if(0==e.resCode)switch(e.res.ymStatus){case"-1":$("#ym-layout").removeClass("ym2-border").removeClass("ym3-border"),$("#ym-content").html('<div class="no-hsym">暂未查询到数据</div>');break;case"0":$("#ym-layout").removeClass("ym2-border").removeClass("ym3-border"),$("#ym-content").html('<div class="ym-result2">未全程接种</div>');break;case"1":$("#ym-layout").removeClass("ym3-border").addClass("ym2-border"),$("#ym-content").html('<div class="ym-result">已全程接种</div>');break;case"2":$("#ym-layout").removeClass("ym2-border").addClass("ym3-border"),$("#ym-content").html('<div class="ym-result">已加强接种</div>'),$("#ym-footer").text("左滑查看");break;default:$("#ym-layout").removeClass("ym2-border").removeClass("ym3-border"),$("#ym-content").html('<div class="no-hsym">暂未查询到数据</div>')}else alert(e.resMessage),queryVaccQcFlag=0},error:function(){alert("E021:网络繁忙,请稍后再试")}})}function queryVaccQc(){0==queryVaccQcFlag&&$.ajax({url:"/healthCode/queryVaccQc",type:"post",dataType:"json",data:{userName:useUserInfo.name,abc:useUserInfo.abc},beforeSend:function(e,t){this.url=apiUrl+this.url,layer.load(2)},success:function(e){if(0==e.resCode){switch(e.res.ymStatus){case"-1":$("#ym-layout").removeClass("ym2-border").removeClass("ym3-border"),$("#ym-content").html('<div class="no-hsym">暂未查询到数据</div>');break;case"0":$("#ym-layout").removeClass("ym2-border").removeClass("ym3-border"),$("#ym-content").html('<div class="ym-result2">未全程接种</div>');break;case"1":$("#ym-layout").removeClass("ym3-border").addClass("ym2-border"),$("#ym-content").html('<div class="ym-result">已全程接种</div>');break;case"2":$("#ym-layout").removeClass("ym2-border").addClass("ym3-border"),$("#ym-content").html('<div class="ym-result">已加强接种</div>');break;default:$("#ym-layout").removeClass("ym2-border").removeClass("ym3-border"),$("#ym-content").html('<div class="no-hsym">暂未查询到数据</div>')}$("#ym-footer").text("左滑查看")}else alert(e.resMessage),queryVaccQcFlag=0},complete:function(){layer.closeAll("loading")},error:function(){alert("E022:网络繁忙,请稍后再试")}})}function queryGjm(){$.ajax({url:"/jkm/2/queryGjm",type:"post",dataType:"json",data:{name:useUserInfo.name,abc:useUserInfo.abc},beforeSend:function(e){layer.load(2),this.url=apiUrl+this.url,$("#cn-layout").empty(),$("#cncode-name").text("")},success:function(e){if(0==e.resCode)if(0<e.res.data.healthyReport.length){var t=e.res.data,s="",o=0;t.healthyReport.forEach(function(e,t){var a="",r="";switch(o+=Number(e.healthyStaus),e.healthyStaus){case"10":a="alert-danger",r="红码(高风险)";break;case"01":a="alert-warning",r="黄码(中风险)";break;case"00":a="alert-success",r="绿码(低风险)"}s+='<div class="alert '+a+'" role="alert"><div class="form-group"><div class="field-label">来源省份:</div><h6 class="text-right">'+e.dataSource+'</h6></div><div class="form-group"><div class="field-label">健康风险:</div><h6 class="text-right">'+r+"</h6></div>","00"==e.healthyStaus?e.reason="":(e.reason||(e.reason=""),"null"==e.reason&&(e.reason=""),'"'==e.reason.substr(0,1)&&(e.reason=e.reason.substr(1)),'"'==e.reason.substr(e.reason.length-1,1)&&(e.reason=e.reason.substr(0,e.reason.length-1))),s+='<div class="form-group" id="reason-group"><div class="field-label">原因:</div><h6 class="text-right">'+e.reason+'</h6></div><div class="form-group"><div class="field-label">健康报告日期:</div><h6 class="text-right">'+e.date+"</h6></div></div>"}),$("#cnnow-time").html(format(e.res.currentTime)),$("#cncode-name").text(t.person.desensitizeName),$("#cn-layout").html(s),$("#cncodes").removeClass("hide"),$("#codes").addClass("hide"),queryQrCode(0==o?"green":"red")}else alert("暂无防疫信息码");else alert(e.resMessage)},complete:function(){layer.closeAll("loading")},error:function(){alert("E014")}})}function queryQrCode(t){$("#cn-code").empty(),$.ajax({url:"/jkm/2/queryQrCode",type:"post",dataType:"json",data:{name:useUserInfo.name,abc:useUserInfo.abc},beforeSend:function(e,t){$(".gjzw").addClass("hide"),this.url=apiUrl+this.url,layer.load(2)},success:function(e){0==e.resCode?($("#cn-code").qrcode({render:"canvas",text:"jkm2020"+e.res.qrCode,width:"220",height:"220",foreground:t}),$(".gjzw").removeClass("hide")):alert("生成国家码失败,请重试")},complete:function(){layer.closeAll("loading")}})}$(".gwyxck-btn").click(function(){if($("#myModal8").modal("show"),$("#xcmphone").text(userinfoDetail.mobile),$(".code").val(""),$(".gwyxck-btn").hasClass("disabled"))return!1;clearInterval(xcmtimer),countXc=60,"点击核验"==$(".gwyxck-btn").text()&&($(".gwyxck-btn").addClass("disabled"),$.ajax({url:"/jkm/2/queryXcYzm",type:"post",dataType:"json",data:{abc:useUserInfo.abc,mAbc:userinfoDetail.mAbc},beforeSend:function(e,t){this.url=apiUrl+this.url},success:function(e){0==e.resCode?(e.res.data.result?layer.msg(e.res.data.result):layer.msg(e.res.data.errorDesc),$(".gwyxck-btn").text("60秒"),xcmtimer=setInterval(function(){countXc--,$(".gwyxck-btn").text(countXc+"秒"),countXc<=0&&(clearInterval(xcmtimer),$(".gwyxck-btn").removeClass("disabled"),$(".gwyxck-btn").text("点击核验"),countXc=60)},1e3)):alert(e.resMessage)},error:function(){alert("E023")}}))}),$(".code").on("input",function(){var e=$(this).val();6==e.length&&jkmCheckXcYzm(e)}),$(".hsjc48-btn").click(function(){if($(".hsjc48-btn").hasClass("disabled"))return!1;$(".hsjc48-btn").addClass("disabled"),queryLatestHs()}),$(function(){$("#queryJKMicon").click(function(){$("#cncodes").addClass("hide"),$("#codes").removeClass("hide")}),$("#queryChinaBtn").click(function(){queryGjm()}),$(".fyxxm").click(function(){"防疫信息码"==$(".fyxxm_name").text()?($(".fyxxm_name").text("健康信息"),$("#cn-code").removeClass("hide"),$("#cn-layout").addClass("hide")):($(".fyxxm_name").text("防疫信息码"),$("#cn-code").addClass("hide"),$("#cn-layout").removeClass("hide"))})});